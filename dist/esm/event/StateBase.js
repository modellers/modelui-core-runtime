import{b as e,_ as t,a as r,c as n,d as o,g as i,j as a,e as s}from"../_rollupPluginBabelHelpers-55d249d8.js";var u,f,c,p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d="undefined"!=typeof Symbol?Symbol("immer-nothing"):(c=!0,(f="immer-nothing")in(u={})?Object.defineProperty(u,f,{value:c,enumerable:!0,configurable:!0,writable:!0}):u[f]=c,u),h="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function v(e){return!!e&&!!e[h]}function y(e){if(!e)return!1;if("object"!==(void 0===e?"undefined":p(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var g=Object.assign||function(e,t){for(var r in t)w(t,r)&&(e[r]=t[r]);return e};function b(e){if(Array.isArray(e))return e.slice();var t=void 0===e.__proto__?Object.create(null):{};return g(t,e)}function m(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t(r,e[r],e);else for(var n in e)t(n,e[n],e)}function w(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function k(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function j(e,t,r,n){Array.isArray(e.base)?function(e,t,r,n){for(var o=e.base,i=e.copy,a=e.assigned,s=Math.min(o.length,i.length),u=0;u<s;u++)if(a[u]&&o[u]!==i[u]){var f=t.concat(u);r.push({op:"replace",path:f,value:i[u]}),n.push({op:"replace",path:f,value:o[u]})}if(s<i.length){for(var c=s;c<i.length;c++)r.push({op:"add",path:t.concat(c),value:i[c]});n.push({op:"replace",path:t.concat("length"),value:o.length})}else if(s<o.length){r.push({op:"replace",path:t.concat("length"),value:i.length});for(var p=s;p<o.length;p++)n.push({op:"add",path:t.concat(p),value:o[p]})}}(e,t,r,n):function(e,t,r,n){var o=e.base,i=e.copy;m(e.assigned,(function(e,a){var s=o[e],u=i[e],f=a?e in o?"replace":"add":"remove";if(s!==o||"replace"!==f){var c=t.concat(e);r.push("remove"===f?{op:f,path:c}:{op:f,path:c,value:u}),n.push("add"===f?{op:"remove",path:c}:"remove"===f?{op:"add",path:c,value:s}:{op:"replace",path:c,value:s})}}))}(e,t,r,n)}var O={},A=[],S=function(){return A[A.length-1]};function E(e,t){var r=void 0;if(v(e)){var n=e[h];n.finalizing=!0,r=b(n.draft),n.finalizing=!1}else r=b(e);m(e,(function(e){Object.defineProperty(r,""+e,function(e){return O[e]||(O[e]={configurable:!0,enumerable:!0,get:function(){return function(e,t){x(e);var r=P(e)[t];if(!e.finalizing&&r===e.base[t]&&y(r))return _(e),e.copy[t]=E(r,e);return r}(this[h],e)},set:function(t){!function(e,t,r){if(x(e),e.assigned[t]=!0,!e.modified){if(k(P(e)[t],r))return;M(e),_(e)}e.copy[t]=r}(this[h],e,t)}})}(""+e))}));var o={scope:t?t.scope:S(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:z,revoked:!1};return function(e,t,r){Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0})}(r,h,o),o.scope.push(o),r}function z(){this.revoked=!0}function P(e){return e.copy||e.base}function M(e){e.modified||(e.modified=!0,e.parent&&M(e.parent))}function _(e){e.copy||(e.copy=b(e.base))}function x(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(e.copy||e.base))}function D(e){if(e&&"object"===(void 0===e?"undefined":p(e))){var t=e[h];if(t){var r=t.base,n=t.draft,o=t.assigned;if(Array.isArray(e)){if(I(t)){if(M(t),o.length=!0,n.length<r.length)for(var i=n.length;i<r.length;i++)o[i]=!1;else for(var a=r.length;a<n.length;a++)o[a]=!0;for(var s=0;s<n.length;s++)void 0===o[s]&&D(n[s])}}else Object.keys(n).forEach((function(e){void 0!==r[e]||w(r,e)?o[e]||D(n[e]):(o[e]=!0,M(t))})),Object.keys(r).forEach((function(e){void 0!==n[e]||w(n,e)||(o[e]=!1,M(t))}))}}}function F(e){for(var t=e.base,r=e.draft,n=Object.keys(r),o=n.length-1;o>=0;o--)if(void 0===t[n[o]]&&!w(t,n[o]))return!0;return n.length!==Object.keys(t).length}function I(e){var t=e.draft;if(t.length!==e.base.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)}var N=Object.freeze({scopes:A,currentScope:S,willFinalize:function(e,t,r){var n=S();n.forEach((function(e){return e.finalizing=!0})),void 0!==e&&e!==t||(r&&D(t),function(e){for(var t=e.length-1;t>=0;t--){var r=e[t];!1===r.modified&&(Array.isArray(r.base)?I(r)&&M(r):F(r)&&M(r))}}(n))},createDraft:E}),C=[],V=function(){return C[C.length-1]};function T(e,t){var r={scope:t?t.scope:V(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},n=Array.isArray(e)?Proxy.revocable([r],U):Proxy.revocable(r,R),o=n.revoke,i=n.proxy;return r.draft=i,r.revoke=o,r.scope.push(r),i}var R={get:function(e,t){if(t===h)return e;var r=e.drafts;if(!e.modified&&w(r,t))return r[t];var n=K(e)[t];if(e.finalized||!y(n))return n;if(e.modified){if(n!==e.base[t])return n;r=e.copy}return r[t]=T(n,e)},has:function(e,t){return t in K(e)},ownKeys:function(e){return Reflect.ownKeys(K(e))},set:function(e,t,r){if(!e.modified){if(r?k(e.base[t],r)||r===e.drafts[t]:k(e.base[t],r)&&t in e.base)return!0;B(e)}return e.assigned[t]=!0,e.copy[t]=r,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,B(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var r=e.modified?e.copy:w(e.drafts,t)?e.drafts:e.base,n=Reflect.getOwnPropertyDescriptor(r,t);!n||Array.isArray(r)&&"length"===t||(n.configurable=!0);return n},defineProperty:function(){throw new Error("Immer does not support defining properties on draft objects.")},setPrototypeOf:function(){throw new Error("Immer does not support `setPrototypeOf()`.")}},U={};function K(e){return e.copy||e.base}function B(e){e.modified||(e.modified=!0,e.copy=g(b(e.base),e.drafts),e.drafts=null,e.parent&&B(e.parent))}m(R,(function(e,t){U[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),U.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer does not support deleting properties from arrays: "+t);return R.deleteProperty.call(this,e[0],t)},U.set=function(e,t,r){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer does not support setting non-numeric properties on arrays: "+t);return R.set.call(this,e[0],t,r)};var H=Object.freeze({scopes:C,currentScope:V,willFinalize:function(){},createDraft:T});var J={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"!=typeof process?"production"!==process.env.NODE_ENV:"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},L=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,J,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return l(e,[{key:"produce",value:function(e,t,r){var n=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return n.produce(a,(function(e){var n;return(n=t).call.apply(n,[e,e].concat(r))}))}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==r&&"function"!=typeof r)throw new Error("the third argument of a producer should not be set or a function");var i=void 0;if(y(e))if(v(e)){if(void 0===(i=t.call(e,e)))return e}else{this.scopes.push([]);var a=this.createDraft(e);try{i=t.call(a,a),this.willFinalize(i,a,!!r);var s=r&&[],u=r&&[];if(void 0===i||i===a)i=this.finalize(a,[],s,u);else{if(a[h].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");y(i)&&(i=this.finalize(i)),r&&(s.push({op:"replace",path:[],value:i}),u.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach((function(e){return e.revoke()})),this.scopes.pop()}r&&r(s,u)}else if(void 0===(i=t(e)))return e;return i===d?void 0:i}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,g(this,e?H:N)}},{key:"finalize",value:function(e,t,r,n){var o=e[h];if(!o)return Object.isFrozen(e)?e:this.finalizeTree(e);if(o.scope!==this.currentScope())return e;if(!o.modified)return o.base;if(!o.finalized){if(o.finalized=!0,this.finalizeTree(o.draft,t,r,n),this.onDelete){var i=o.assigned;for(var a in i)i[a]||this.onDelete(o,a)}this.onCopy&&this.onCopy(o),this.autoFreeze&&1===this.scopes.length&&Object.freeze(o.copy),r&&j(o,t,r,n)}return o.copy}},{key:"finalizeTree",value:function(e,t,r,n){var o=this,i=e[h];i&&(e=this.useProxies?i.copy:i.copy=b(i.draft));var a=this.onAssign;return m(e,(function s(u,f,c){var p=!!i&&c===e;if(v(f)){if(c[u]=f=r&&p&&!i.assigned[u]?o.finalize(f,t.concat(u),r,n):o.finalize(f),p&&f===i.base[u])return}else{if(p&&k(f,i.base[u]))return;y(f)&&!Object.isFrozen(f)&&m(f,s)}p&&a&&a(i,u,f)})),e}}]),e}(),$=(new L).produce;$((function(e,t){for(var r=0;r<t.length;r++){var n=t[r],o=n.path;if(0===o.length&&"replace"===n.op)e=n.value;else{for(var i=e,a=0;a<o.length-1;a++)if(!(i=i[o[a]])||"object"!==(void 0===i?"undefined":p(i)))throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var s=o[o.length-1];switch(n.op){case"replace":case"add":i[s]=n.value;break;case"remove":if(Array.isArray(i)){if(s!==i.length-1)throw new Error("Only the last index of an array can be removed, index: "+s+", length: "+i.length);i.length-=1}else delete i[s];break;default:throw new Error("Unsupported patch operation: "+n.op)}}}return e}));var q=function(){function t(){n(this,t),o(this,"state",{}),o(this,"mount",null)}return e(t,[{key:"__updateObject",value:function(e,t){for(var r=0,n=Object.entries(t);r<n.length;r++){var o=i(n[r],2),s=o[0],u=o[1];e.hasOwnProperty(s)&&a(u)===a(e[s])&&(["string","number","boolean"].includes(a(u))||Array.isArray(u)||"[object Date]"===Object.prototype.toString.call(u)?e[s]=u:"object"===a(u)&&this.__updateObject(e[s],u))}}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e,t){this.state=e,t||this.mount&&this.mount.setState&&this.mount.setState(e)}},{key:"getActionState",value:function(e,t){this.mount&&this.mount.getActionState?this.mount.getActionState(e,t):t()}},{key:"alterState",value:function(e,t){var r=this;if(void 0===e)return this.state;if("object"===a(e)){var n=$(this.state,(function(t){r.__updateObject(t,e)}));return this.setState(n,t),n}var o=$(this.state,e);return this.setState(o,t),o}},{key:"doMount",value:function(e){this.mount=e}},{key:"unMount",value:function(e){this.mount=null}},{key:"updateView",value:function(e,t,r,n){return this.mount&&this.mount.updateView&&this.mount.updateView(e,t,r,n),!0}}]),t}(),G=function(i){t(u,q);var a=r(u);function u(e){var t;if(n(this,u),t=a.call(this,e),o(s(t),"updateView",(function(e,t,r,n){return!0})),t.props=e,!t.props.manager)throw"Manager was not provided through props for component "+t.props.id;return t.eventManager=t.props.manager.getEventManager(),t}return e(u,[{key:"triggerEvent",value:function(e,t,r){this.props.manager.getEventManager().addEvent(this.props.id,e,t,r)}},{key:"triggerAction",value:function(e,t,r){this.props.manager.getEventManager().addAction(this.props.id,e,t,null,r)}},{key:"register",value:function(e,t,r){this.props.manager.getEventManager().register(this.props.id,e,t,r)}},{key:"setInstanceState",value:function(e){this.stateManager&&this.stateManager.setState(e)}}]),u}(),Q=function(i){t(u,q);var a=r(u);function u(e){var t;if(n(this,u),t=a.call(this,e),o(s(t),"updateView",(function(e,t,r,n){return!0})),t.props=e,!t.props.manager)throw"Manager was not provided through props for component "+t.props.id;return t.eventManager=t.props.manager.getEventManager(),t}return e(u,[{key:"triggerEvent",value:function(e,t,r){this.props.manager.getEventManager().addEvent(this.props.id,e,t,r)}},{key:"triggerAction",value:function(e,t,r){this.props.manager.getEventManager().addAction(this.props.id,e,t,null,r)}},{key:"register",value:function(e,t,r){this.props.manager.getEventManager().register(this.props.id,e,t,r)}},{key:"setInstanceState",value:function(e){this.stateManager&&this.stateManager.setState(e)}}]),u}(),W={StateInstance:q,StateLess:G,StateFull:Q};export{Q as StateFull,q as StateInstance,G as StateLess,W as default};
//# sourceMappingURL=StateBase.js.map
