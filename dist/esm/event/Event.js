import{d as t,b as n,c as e,j as i,g as o}from"../_rollupPluginBabelHelpers-55d249d8.js";var a=function(){function a(){e(this,a),t(this,"_events",{}),t(this,"_watching",{}),t(this,"_actions",{}),t(this,"_components",{}),t(this,"_component_instance_type",{})}return n(a,[{key:"getType",value:function(t){return(("object"===i(t)?null===t?"null":"function"!=typeof t.constructor?"object":t.constructor.name:"boolean"==typeof t?"boolean":"number"==typeof t?"number":"string"==typeof t?"string":"function"==typeof t&&"function")+"").toLowerCase()}},{key:"clearAll",value:function(){this._events={},this._watching={},this._actions={},this._component_instance_type={}}},{key:"warnRegistration",value:function(t,n,e,i){var o="Update registration for "+t+" "+n+"."+e+" : "+i;console.warn(o)}},{key:"warnInfoRegistration",value:function(t,n){console.warn("Update registration for "+t+": "+n)}},{key:"valid",value:function(t,n,e,i,o,a,s){t.hasOwnProperty(n)||(t[n]=i,this.warnRegistration(s,o,a,"Attribute "+n+" missing. Using default value.")),this.getType(t[n])!==e&&this.warnRegistration(s,o,a,"Attribute ".concat(n," should be of type ").concat(e," but is ").concat(this.getType(t[n])," using default values."))}},{key:"validInputsForUI",value:function(t,n,e,i){this.valid(t,"schema","object",{type:"object",title:e+"-"+i,description:"Auto generated"},e,i,n)}},{key:"capitalize",value:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}},{key:"register",value:function(t,n,e,i){var o=this;i?(this._components[i.type]=i,this._components[i.type].actions=n,this._components[i.type].events=e,this._component_instance_type[t]=i.type):console.warn("Component info is missing for "+t),this._actions[t]={},this._events[t]=e||{},Object.keys(n).forEach((function(e){var i=n[e];"function"==typeof i&&(i={handler:i},o.warnRegistration(t,e,"Function handler should be defined as handler in an object. Auto refactoring done.")),o.validInputsForUI(i,"action",t,e),o._actions[t][e]=i}));var a={};return Object.keys(this._events[t]).forEach((function(n){var e=n;o._events[t][n].id?a[n]={id:o._events[t][n].id}:(o._events[t][n].id=e,a[n]={id:e}),o.validInputsForUI(o._events[t][n],"event",t,n)})),a}},{key:"addToWatchList",value:function(t,n,e,i,o){this._watching[t]||(this._watching[t]={}),void 0===this._watching[t][n]&&(this._watching[t][n]=[]),this._watching[t][n].push({tid:e,act:i,transf:o})}},{key:"watch",value:function(t){var n=this;!1===Array.isArray(t)&&(t=[t]);for(var e=function(){var e=t[i],a=e.component.id,s=e.component.event;e.component.filter?(e.component.regex||(e.component.regex=new RegExp(e.component.filter)),Object.entries(n._actions).forEach((function(t){var i=o(t,2),a=i[0];i[1],e.component.regex.exec(a)&&n.addToWatchList(a,s,e.trigger.id,e.trigger.action,e.transform)}))):a&&n.addToWatchList(a,s,e.trigger.id,e.trigger.action,e.transform)},i=0;i<t.length;i++)e()}},{key:"addEvent",value:function(t,n,e,i){if(this._watching[t]){var o=this._watching[t][n]||[];for(var a in o){var s=o[a];this.addAction(s.tid,s.act,e,s.transf,i)}}}},{key:"addAction",value:function(t,n,e,i,o){if(this._actions[t]&&this._actions[t][n]){var a=e;if(i)try{a=i(e)}catch(t){console.error("Transform failed",t)}a&&this._actions[t][n].handler(a,o)}}},{key:"getCopyOfEvents",value:function(){return Object.assign({},this._events)}},{key:"getCopyOfWatchers",value:function(){return Object.assign({},this._watching)}},{key:"getCopyOfActions",value:function(){return Object.assign({},this._actions)}},{key:"collectComponentInventory",value:function(){for(var t={},n=0,e=Object.entries(this._components);n<e.length;n++){var i=o(e[n],2),a=i[0],s=i[1],r="";s.relation&&(r=s.relation.within),t[a]={id:s.type,title:s.name,type:s.type,parent:r}}return t}},{key:"getComponentSchema",value:function(t){return this._components[t].options}},{key:"getComponentByType",value:function(t){return this._components[t]}},{key:"getComponentsRegistered",value:function(){return Object.keys(this._component_instance_type)}},{key:"getComponentType",value:function(t){return this._component_instance_type[t]}}],[{key:"getInstance",value:function(){return null===a._instance&&(a._instance=new a),this._instance}}]),a}();t(a,"_instance",null);var s={EventManager:a,getTransformFunction:function(t){if("string"!=typeof(t.transform||t.code))return"Event code attribute is missing";try{return Function("data",t.transform||t.code)}catch(t){return t+""}}};export{s as default};
//# sourceMappingURL=Event.js.map
