{"version":3,"file":"XMLParser.test.js","sources":["../../../../src/components/Data/XMLParser.test.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\n/**\n * MenuComponent tests\n * Testing DD events and actions integrety\n */\n\nimport { XMLParser, events, triggers, config } from './XMLParser'\nimport {\n  createComponentClassTests,\n  createComponentRegisterTests,\n  testEventSequence\n} from '../../util/TestUtil'\nimport Manager from '../../layout/Manager'\nimport registerComponents from '../Components'\nimport Event from '../../event/Event'\n\ndescribe('XMLParser protocol', () => {\n  const tests = createComponentClassTests(\n    Manager.ComponentManager.getInstance(),\n    registerComponents,\n    null,\n    config,\n    ['read', 'convert'],\n    [\n      'reading',\n      'read',\n      'failure_reading',\n      'converting',\n      'converted',\n      'failure_converting'\n    ],\n    {},\n    undefined,\n    { render: false }\n  )\n  tests.forEach((t) => {\n    test(t.title, t.test)\n  })\n})\n\ndescribe('XMLParser register', () => {\n  const tests = createComponentRegisterTests(\n    Manager.ComponentManager.getInstance(),\n    registerComponents,\n    'xml',\n    XMLParser,\n    triggers,\n    events,\n    config,\n    {}\n  )\n  tests.forEach((t) => {\n    test(t.title, t.test)\n  })\n})\n\ndescribe('XMLParser memory test', () => {\n  const objectCollection = null\n\n  beforeEach(() => {\n    Event.EventManager.getInstance().clearAll()\n  })\n\n  test('Parsing simple XML', (done) => {\n    const xmlParser = new XMLParser({\n      id: 'test_xmlParser',\n      schema: {},\n      data: {},\n      type: 'xml',\n      manager: Manager.ComponentManager.getInstance()\n    })\n\n    testEventSequence(\n      Manager.ComponentManager.getInstance(),\n      'test_xmlParser',\n      'read',\n      {\n        xml: '<foo attr=\"value\">bar</foo>'\n      },\n      'read',\n      (obj) => {\n        expect(obj).toEqual({\n          json: { foo: { '#text': 'bar', '@_attr': 'value' } }\n        })\n        done()\n      }\n    )\n  })\n\n  test('Parsing to XML using generated JSON', (done) => {\n    const xmlParser = new XMLParser({\n      id: 'test_xmlParser',\n      schema: {},\n      data: {},\n      type: 'xml',\n      manager: Manager.ComponentManager.getInstance()\n    })\n\n    testEventSequence(\n      Manager.ComponentManager.getInstance(),\n      'test_xmlParser',\n      'convert',\n      {\n        json: { foo: { '#text': 'bar', '@_attr': 'value' } }\n      },\n      'converted',\n      (obj) => {\n        expect(obj).toEqual({ xml: '<foo attr=\"value\">bar</foo>\\n' })\n        done()\n      }\n    )\n  })\n\n  test('Parsing simple CMMN', (done) => {\n    const xmlParser = new XMLParser({\n      id: 'test_xmlParser',\n      schema: {},\n      data: {},\n      type: 'xml',\n      manager: Manager.ComponentManager.getInstance()\n    })\n\n    testEventSequence(\n      Manager.ComponentManager.getInstance(),\n      'test_xmlParser',\n      'read',\n      {\n        xml: test_data_cmmn_xml\n      },\n      'read',\n      (obj) => {\n        expect(obj).toEqual(test_data_cmmn_json)\n        done()\n      }\n    )\n  })\n})\n\n// TODO: add this data in a test (to and from xml)\nconst test_data_1car = `\n<car>\n  <color alpha=\"7\">purple</color>\n  <type>minivan</type>\n  <registration>2020-02-03</registration>\n  <capacity>7</capacity>\n</car>\n`\n\nconst test_data_cmmn_xml = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<cmmn:definitions xmlns:dc=\"http://www.omg.org/spec/CMMN/20151109/DC\" xmlns:cmmndi=\"http://www.omg.org/spec/CMMN/20151109/CMMNDI\" xmlns:cmmn=\"http://www.omg.org/spec/CMMN/20151109/MODEL\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:di=\"http://www.omg.org/spec/CMMN/20151109/DI\" id=\"Definitions_0q2hekz\" targetNamespace=\"http://bpmn.io/schema/cmmn\" exporter=\"cmmn-js (https://demo.bpmn.io/cmmn)\" exporterVersion=\"0.20.0\">\n    <cmmn:case id=\"Case_0mbeegm\">\n        <cmmn:casePlanModel id=\"CasePlanModel_0l75tfv\" name=\"A CasePlanModel\">\n            <cmmn:planItem id=\"PlanItem_0nndxko\" definitionRef=\"Task_14nbr0o\">\n                <cmmn:entryCriterion id=\"EntryCriterion_0i4ja07\" sentryRef=\"Sentry_18pc5du\" />\n            </cmmn:planItem>\n            <cmmn:planItem id=\"PlanItem_0th8d5v\" definitionRef=\"EventListener_0poum21\" />\n            <cmmn:sentry id=\"Sentry_18pc5du\">\n                <cmmn:planItemOnPart id=\"PlanItemOnPart_125ga5x\" sourceRef=\"PlanItem_0th8d5v\">\n                    <cmmn:standardEvent>occur</cmmn:standardEvent>\n                </cmmn:planItemOnPart>\n            </cmmn:sentry>\n            <cmmn:task id=\"Task_14nbr0o\" name=\"Task item\" />\n            <cmmn:eventListener id=\"EventListener_0poum21\" name=\"Page load\" />\n        </cmmn:casePlanModel>\n    </cmmn:case>\n    <cmmndi:CMMNDI>\n        <cmmndi:CMMNDiagram id=\"CMMNDiagram_1\">\n            <cmmndi:Size width=\"500\" height=\"500\" />\n            <cmmndi:CMMNShape id=\"DI_CasePlanModel_0l75tfv\" cmmnElementRef=\"CasePlanModel_0l75tfv\">\n                <dc:Bounds x=\"156\" y=\"99\" width=\"534\" height=\"389\" />\n                <cmmndi:CMMNLabel />\n            </cmmndi:CMMNShape>\n            <cmmndi:CMMNShape id=\"PlanItem_0nndxko_di\" cmmnElementRef=\"PlanItem_0nndxko\">\n                <dc:Bounds x=\"512\" y=\"268\" width=\"100\" height=\"80\" />\n                <cmmndi:CMMNLabel />\n            </cmmndi:CMMNShape>\n            <cmmndi:CMMNShape id=\"PlanItem_0th8d5v_di\" cmmnElementRef=\"PlanItem_0th8d5v\">\n                <dc:Bounds x=\"244\" y=\"250\" width=\"36\" height=\"36\" />\n                <cmmndi:CMMNLabel>\n                    <dc:Bounds x=\"236\" y=\"286\" width=\"51\" height=\"13\" />\n                </cmmndi:CMMNLabel>\n            </cmmndi:CMMNShape>\n            <cmmndi:CMMNShape id=\"EntryCriterion_0i4ja07_di\" cmmnElementRef=\"EntryCriterion_0i4ja07\">\n                <dc:Bounds x=\"502\" y=\"294\" width=\"20\" height=\"28\" />\n                <cmmndi:CMMNLabel />\n            </cmmndi:CMMNShape>\n            <cmmndi:CMMNEdge id=\"PlanItemOnPart_125ga5x_di\" cmmnElementRef=\"PlanItemOnPart_125ga5x\" targetCMMNElementRef=\"EntryCriterion_0i4ja07\" isStandardEventVisible=\"true\">\n                <di:waypoint x=\"280\" y=\"268\" />\n                <di:waypoint x=\"391\" y=\"268\" />\n                <di:waypoint x=\"391\" y=\"308\" />\n                <di:waypoint x=\"502\" y=\"308\" />\n                <cmmndi:CMMNLabel>\n                    <dc:Bounds x=\"379\" y=\"276\" width=\"35\" height=\"13\" />\n                </cmmndi:CMMNLabel>\n            </cmmndi:CMMNEdge>\n        </cmmndi:CMMNDiagram>\n    </cmmndi:CMMNDI>\n</cmmn:definitions>\n`\nexport const test_data_cmmn_json = {\n  json: {\n    '?xml': {\n      '@_version': '1.0',\n      '@_encoding': 'UTF-8'\n    },\n    'cmmn:definitions': {\n      'cmmn:case': {\n        'cmmn:casePlanModel': {\n          'cmmn:planItem': [\n            {\n              'cmmn:entryCriterion': {\n                '@_id': 'EntryCriterion_0i4ja07',\n                '@_sentryRef': 'Sentry_18pc5du'\n              },\n              '@_id': 'PlanItem_0nndxko',\n              '@_definitionRef': 'Task_14nbr0o'\n            },\n            {\n              '@_id': 'PlanItem_0th8d5v',\n              '@_definitionRef': 'EventListener_0poum21'\n            }\n          ],\n          'cmmn:sentry': {\n            'cmmn:planItemOnPart': {\n              'cmmn:standardEvent': 'occur',\n              '@_id': 'PlanItemOnPart_125ga5x',\n              '@_sourceRef': 'PlanItem_0th8d5v'\n            },\n            '@_id': 'Sentry_18pc5du'\n          },\n          'cmmn:task': {\n            '@_id': 'Task_14nbr0o',\n            '@_name': 'Task item'\n          },\n          'cmmn:eventListener': {\n            '@_id': 'EventListener_0poum21',\n            '@_name': 'Page load'\n          },\n          '@_id': 'CasePlanModel_0l75tfv',\n          '@_name': 'A CasePlanModel'\n        },\n        '@_id': 'Case_0mbeegm'\n      },\n      'cmmndi:CMMNDI': {\n        'cmmndi:CMMNDiagram': {\n          'cmmndi:Size': {\n            '@_width': '500',\n            '@_height': '500'\n          },\n          'cmmndi:CMMNShape': [\n            {\n              'dc:Bounds': {\n                '@_x': '156',\n                '@_y': '99',\n                '@_width': '534',\n                '@_height': '389'\n              },\n              'cmmndi:CMMNLabel': '',\n              '@_id': 'DI_CasePlanModel_0l75tfv',\n              '@_cmmnElementRef': 'CasePlanModel_0l75tfv'\n            },\n            {\n              'dc:Bounds': {\n                '@_x': '512',\n                '@_y': '268',\n                '@_width': '100',\n                '@_height': '80'\n              },\n              'cmmndi:CMMNLabel': '',\n              '@_id': 'PlanItem_0nndxko_di',\n              '@_cmmnElementRef': 'PlanItem_0nndxko'\n            },\n            {\n              'dc:Bounds': {\n                '@_x': '244',\n                '@_y': '250',\n                '@_width': '36',\n                '@_height': '36'\n              },\n              'cmmndi:CMMNLabel': {\n                'dc:Bounds': {\n                  '@_x': '236',\n                  '@_y': '286',\n                  '@_width': '51',\n                  '@_height': '13'\n                }\n              },\n              '@_id': 'PlanItem_0th8d5v_di',\n              '@_cmmnElementRef': 'PlanItem_0th8d5v'\n            },\n            {\n              'dc:Bounds': {\n                '@_x': '502',\n                '@_y': '294',\n                '@_width': '20',\n                '@_height': '28'\n              },\n              'cmmndi:CMMNLabel': '',\n              '@_id': 'EntryCriterion_0i4ja07_di',\n              '@_cmmnElementRef': 'EntryCriterion_0i4ja07'\n            }\n          ],\n          'cmmndi:CMMNEdge': {\n            'di:waypoint': [\n              {\n                '@_x': '280',\n                '@_y': '268'\n              },\n              {\n                '@_x': '391',\n                '@_y': '268'\n              },\n              {\n                '@_x': '391',\n                '@_y': '308'\n              },\n              {\n                '@_x': '502',\n                '@_y': '308'\n              }\n            ],\n            'cmmndi:CMMNLabel': {\n              'dc:Bounds': {\n                '@_x': '379',\n                '@_y': '276',\n                '@_width': '35',\n                '@_height': '13'\n              }\n            },\n            '@_id': 'PlanItemOnPart_125ga5x_di',\n            '@_cmmnElementRef': 'PlanItemOnPart_125ga5x',\n            '@_targetCMMNElementRef': 'EntryCriterion_0i4ja07',\n            '@_isStandardEventVisible': 'true'\n          },\n          '@_id': 'CMMNDiagram_1'\n        }\n      },\n      '@_xmlns:dc': 'http://www.omg.org/spec/CMMN/20151109/DC',\n      '@_xmlns:cmmndi': 'http://www.omg.org/spec/CMMN/20151109/CMMNDI',\n      '@_xmlns:cmmn': 'http://www.omg.org/spec/CMMN/20151109/MODEL',\n      '@_xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n      '@_xmlns:di': 'http://www.omg.org/spec/CMMN/20151109/DI',\n      '@_id': 'Definitions_0q2hekz',\n      '@_targetNamespace': 'http://bpmn.io/schema/cmmn',\n      '@_exporter': 'cmmn-js (https://demo.bpmn.io/cmmn)',\n      '@_exporterVersion': '0.20.0'\n    }\n  }\n}\n"],"names":["describe","createComponentClassTests","Manager","ComponentManager","getInstance","registerComponents","config","undefined","render","forEach","t","test","title","createComponentRegisterTests","XMLParser","triggers","events","beforeEach","Event","EventManager","clearAll","done","id","schema","data","type","manager","testEventSequence","xml","obj","expect","toEqual","json","foo","test_data_cmmn_xml","test_data_cmmn_json"],"mappings":"imBAgBAA,SAAS,sBAAsB,WACfC,4BACZC,EAAAA,QAAQC,iBAAiBC,cACzBC,EACA,KACAC,EAAAA,OACA,CAAC,OAAQ,WACT,CACE,UACA,OACA,kBACA,aACA,YACA,sBAEF,CAAE,OACFC,EACA,CAAEC,QAAQ,IAENC,SAAQ,SAACC,GACbC,KAAKD,EAAEE,MAAOF,EAAEC,KAClB,GACF,IAEAX,SAAS,sBAAsB,WACfa,EAA4BA,6BACxCX,EAAO,QAACC,iBAAiBC,cACzBC,EACA,MACAS,EAASA,UACTC,EAAQA,SACRC,EAAMA,OACNV,EAAMA,OACN,CAAE,GAEEG,SAAQ,SAACC,GACbC,KAAKD,EAAEE,MAAOF,EAAEC,KAClB,GACF,IAEAX,SAAS,yBAAyB,WAGhCiB,YAAW,WACTC,EAAMC,aAAaf,cAAcgB,UACnC,IAEAT,KAAK,sBAAsB,SAACU,GACR,IAAIP,YAAU,CAC9BQ,GAAI,iBACJC,OAAQ,CAAE,EACVC,KAAM,CAAE,EACRC,KAAM,MACNC,QAASxB,EAAAA,QAAQC,iBAAiBC,gBAGpCuB,EAAiBA,kBACfzB,EAAO,QAACC,iBAAiBC,cACzB,iBACA,OACA,CACEwB,IAAK,+BAEP,QACA,SAACC,GACCC,OAAOD,GAAKE,QAAQ,CAClBC,KAAM,CAAEC,IAAK,CAAE,QAAS,MAAO,SAAU,YAE3CZ,GACF,GAEJ,IAEAV,KAAK,uCAAuC,SAACU,GACzB,IAAIP,YAAU,CAC9BQ,GAAI,iBACJC,OAAQ,CAAE,EACVC,KAAM,CAAE,EACRC,KAAM,MACNC,QAASxB,EAAAA,QAAQC,iBAAiBC,gBAGpCuB,EAAiBA,kBACfzB,EAAO,QAACC,iBAAiBC,cACzB,iBACA,UACA,CACE4B,KAAM,CAAEC,IAAK,CAAE,QAAS,MAAO,SAAU,WAE3C,aACA,SAACJ,GACCC,OAAOD,GAAKE,QAAQ,CAAEH,IAAK,kCAC3BP,GACF,GAEJ,IAEAV,KAAK,uBAAuB,SAACU,GACT,IAAIP,YAAU,CAC9BQ,GAAI,iBACJC,OAAQ,CAAE,EACVC,KAAM,CAAE,EACRC,KAAM,MACNC,QAASxB,EAAAA,QAAQC,iBAAiBC,gBAGpCuB,EAAiBA,kBACfzB,EAAO,QAACC,iBAAiBC,cACzB,iBACA,OACA,CACEwB,IAAKM,GAEP,QACA,SAACL,GACCC,OAAOD,GAAKE,QAAQI,GACpBd,GACF,GAEJ,GACF,IAYA,IAAMa,EAkDL,smGACYC,EAAsB,CACjCH,KAAM,CACJ,OAAQ,CACN,YAAa,MACb,aAAc,SAEhB,mBAAoB,CAClB,YAAa,CACX,qBAAsB,CACpB,gBAAiB,CACf,CACE,sBAAuB,CACrB,OAAQ,yBACR,cAAe,kBAEjB,OAAQ,mBACR,kBAAmB,gBAErB,CACE,OAAQ,mBACR,kBAAmB,0BAGvB,cAAe,CACb,sBAAuB,CACrB,qBAAsB,QACtB,OAAQ,yBACR,cAAe,oBAEjB,OAAQ,kBAEV,YAAa,CACX,OAAQ,eACR,SAAU,aAEZ,qBAAsB,CACpB,OAAQ,wBACR,SAAU,aAEZ,OAAQ,wBACR,SAAU,mBAEZ,OAAQ,gBAEV,gBAAiB,CACf,qBAAsB,CACpB,cAAe,CACb,UAAW,MACX,WAAY,OAEd,mBAAoB,CAClB,CACE,YAAa,CACX,MAAO,MACP,MAAO,KACP,UAAW,MACX,WAAY,OAEd,mBAAoB,GACpB,OAAQ,2BACR,mBAAoB,yBAEtB,CACE,YAAa,CACX,MAAO,MACP,MAAO,MACP,UAAW,MACX,WAAY,MAEd,mBAAoB,GACpB,OAAQ,sBACR,mBAAoB,oBAEtB,CACE,YAAa,CACX,MAAO,MACP,MAAO,MACP,UAAW,KACX,WAAY,MAEd,mBAAoB,CAClB,YAAa,CACX,MAAO,MACP,MAAO,MACP,UAAW,KACX,WAAY,OAGhB,OAAQ,sBACR,mBAAoB,oBAEtB,CACE,YAAa,CACX,MAAO,MACP,MAAO,MACP,UAAW,KACX,WAAY,MAEd,mBAAoB,GACpB,OAAQ,4BACR,mBAAoB,2BAGxB,kBAAmB,CACjB,cAAe,CACb,CACE,MAAO,MACP,MAAO,OAET,CACE,MAAO,MACP,MAAO,OAET,CACE,MAAO,MACP,MAAO,OAET,CACE,MAAO,MACP,MAAO,QAGX,mBAAoB,CAClB,YAAa,CACX,MAAO,MACP,MAAO,MACP,UAAW,KACX,WAAY,OAGhB,OAAQ,4BACR,mBAAoB,yBACpB,yBAA0B,yBAC1B,2BAA4B,QAE9B,OAAQ,kBAGZ,aAAc,2CACd,iBAAkB,+CAClB,eAAgB,8CAChB,cAAe,4CACf,aAAc,2CACd,OAAQ,sBACR,oBAAqB,6BACrB,aAAc,sCACd,oBAAqB"}