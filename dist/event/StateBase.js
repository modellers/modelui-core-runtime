"use strict";var e,t,r,n=require("../_rollupPluginBabelHelpers-b58f8590.js"),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a="undefined"!=typeof Symbol?Symbol("immer-nothing"):(r=!0,(t="immer-nothing")in(e={})?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e),u="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function s(e){return!!e&&!!e[u]}function f(e){if(!e)return!1;if("object"!==(void 0===e?"undefined":o(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var c=Object.assign||function(e,t){for(var r in t)d(t,r)&&(e[r]=t[r]);return e};function l(e){if(Array.isArray(e))return e.slice();var t=void 0===e.__proto__?Object.create(null):{};return c(t,e)}function p(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t(r,e[r],e);else for(var n in e)t(n,e[n],e)}function d(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function h(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function y(e,t,r,n){Array.isArray(e.base)?function(e,t,r,n){for(var o=e.base,i=e.copy,a=e.assigned,u=Math.min(o.length,i.length),s=0;s<u;s++)if(a[s]&&o[s]!==i[s]){var f=t.concat(s);r.push({op:"replace",path:f,value:i[s]}),n.push({op:"replace",path:f,value:o[s]})}if(u<i.length){for(var c=u;c<i.length;c++)r.push({op:"add",path:t.concat(c),value:i[c]});n.push({op:"replace",path:t.concat("length"),value:o.length})}else if(u<o.length){r.push({op:"replace",path:t.concat("length"),value:i.length});for(var l=u;l<o.length;l++)n.push({op:"add",path:t.concat(l),value:o[l]})}}(e,t,r,n):function(e,t,r,n){var o=e.base,i=e.copy;p(e.assigned,(function(e,a){var u=o[e],s=i[e],f=a?e in o?"replace":"add":"remove";if(u!==o||"replace"!==f){var c=t.concat(e);r.push("remove"===f?{op:f,path:c}:{op:f,path:c,value:s}),n.push("add"===f?{op:"remove",path:c}:"remove"===f?{op:"add",path:c,value:u}:{op:"replace",path:c,value:u})}}))}(e,t,r,n)}var v={},b=[],g=function(){return b[b.length-1]};function m(e,t){var r=void 0;if(s(e)){var n=e[u];n.finalizing=!0,r=l(n.draft),n.finalizing=!1}else r=l(e);p(e,(function(e){Object.defineProperty(r,""+e,function(e){return v[e]||(v[e]={configurable:!0,enumerable:!0,get:function(){return function(e,t){z(e);var r=O(e)[t];if(!e.finalizing&&r===e.base[t]&&f(r))return k(e),e.copy[t]=m(r,e);return r}(this[u],e)},set:function(t){!function(e,t,r){if(z(e),e.assigned[t]=!0,!e.modified){if(h(O(e)[t],r))return;j(e),k(e)}e.copy[t]=r}(this[u],e,t)}})}(""+e))}));var o={scope:t?t.scope:g(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:w,revoked:!1};return function(e,t,r){Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0})}(r,u,o),o.scope.push(o),r}function w(){this.revoked=!0}function O(e){return e.copy||e.base}function j(e){e.modified||(e.modified=!0,e.parent&&j(e.parent))}function k(e){e.copy||(e.copy=l(e.base))}function z(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(e.copy||e.base))}function A(e){if(e&&"object"===(void 0===e?"undefined":o(e))){var t=e[u];if(t){var r=t.base,n=t.draft,i=t.assigned;if(Array.isArray(e)){if(S(t)){if(j(t),i.length=!0,n.length<r.length)for(var a=n.length;a<r.length;a++)i[a]=!1;else for(var s=r.length;s<n.length;s++)i[s]=!0;for(var f=0;f<n.length;f++)void 0===i[f]&&A(n[f])}}else Object.keys(n).forEach((function(e){void 0!==r[e]||d(r,e)?i[e]||A(n[e]):(i[e]=!0,j(t))})),Object.keys(r).forEach((function(e){void 0!==n[e]||d(n,e)||(i[e]=!1,j(t))}))}}}function P(e){for(var t=e.base,r=e.draft,n=Object.keys(r),o=n.length-1;o>=0;o--)if(void 0===t[n[o]]&&!d(t,n[o]))return!0;return n.length!==Object.keys(t).length}function S(e){var t=e.draft;if(t.length!==e.base.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)}var _=Object.freeze({scopes:b,currentScope:g,willFinalize:function(e,t,r){var n=g();n.forEach((function(e){return e.finalizing=!0})),void 0!==e&&e!==t||(r&&A(t),function(e){for(var t=e.length-1;t>=0;t--){var r=e[t];!1===r.modified&&(Array.isArray(r.base)?S(r)&&j(r):P(r)&&j(r))}}(n))},createDraft:m}),E=[],x=function(){return E[E.length-1]};function D(e,t){var r={scope:t?t.scope:x(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},n=Array.isArray(e)?Proxy.revocable([r],F):Proxy.revocable(r,C),o=n.revoke,i=n.proxy;return r.draft=i,r.revoke=o,r.scope.push(r),i}var C={get:function(e,t){if(t===u)return e;var r=e.drafts;if(!e.modified&&d(r,t))return r[t];var n=I(e)[t];if(e.finalized||!f(n))return n;if(e.modified){if(n!==e.base[t])return n;r=e.copy}return r[t]=D(n,e)},has:function(e,t){return t in I(e)},ownKeys:function(e){return Reflect.ownKeys(I(e))},set:function(e,t,r){if(!e.modified){if(r?h(e.base[t],r)||r===e.drafts[t]:h(e.base[t],r)&&t in e.base)return!0;N(e)}return e.assigned[t]=!0,e.copy[t]=r,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,N(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var r=e.modified?e.copy:d(e.drafts,t)?e.drafts:e.base,n=Reflect.getOwnPropertyDescriptor(r,t);!n||Array.isArray(r)&&"length"===t||(n.configurable=!0);return n},defineProperty:function(){throw new Error("Immer does not support defining properties on draft objects.")},setPrototypeOf:function(){throw new Error("Immer does not support `setPrototypeOf()`.")}},F={};function I(e){return e.copy||e.base}function N(e){e.modified||(e.modified=!0,e.copy=c(l(e.base),e.drafts),e.drafts=null,e.parent&&N(e.parent))}p(C,(function(e,t){F[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),F.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer does not support deleting properties from arrays: "+t);return C.deleteProperty.call(this,e[0],t)},F.set=function(e,t,r){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer does not support setting non-numeric properties on arrays: "+t);return C.set.call(this,e[0],t,r)};var T=Object.freeze({scopes:E,currentScope:x,willFinalize:function(){},createDraft:D});var M={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"!=typeof process?"production"!==process.env.NODE_ENV:"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},V=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,M,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return i(e,[{key:"produce",value:function(e,t,r){var n=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return n.produce(a,(function(e){var n;return(n=t).call.apply(n,[e,e].concat(r))}))}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==r&&"function"!=typeof r)throw new Error("the third argument of a producer should not be set or a function");var i=void 0;if(f(e))if(s(e)){if(void 0===(i=t.call(e,e)))return e}else{this.scopes.push([]);var c=this.createDraft(e);try{i=t.call(c,c),this.willFinalize(i,c,!!r);var l=r&&[],p=r&&[];if(void 0===i||i===c)i=this.finalize(c,[],l,p);else{if(c[u].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");f(i)&&(i=this.finalize(i)),r&&(l.push({op:"replace",path:[],value:i}),p.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach((function(e){return e.revoke()})),this.scopes.pop()}r&&r(l,p)}else if(void 0===(i=t(e)))return e;return i===a?void 0:i}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,c(this,e?T:_)}},{key:"finalize",value:function(e,t,r,n){var o=e[u];if(!o)return Object.isFrozen(e)?e:this.finalizeTree(e);if(o.scope!==this.currentScope())return e;if(!o.modified)return o.base;if(!o.finalized){if(o.finalized=!0,this.finalizeTree(o.draft,t,r,n),this.onDelete){var i=o.assigned;for(var a in i)i[a]||this.onDelete(o,a)}this.onCopy&&this.onCopy(o),this.autoFreeze&&1===this.scopes.length&&Object.freeze(o.copy),r&&y(o,t,r,n)}return o.copy}},{key:"finalizeTree",value:function(e,t,r,n){var o=this,i=e[u];i&&(e=this.useProxies?i.copy:i.copy=l(i.draft));var a=this.onAssign;return p(e,(function u(c,l,d){var y=!!i&&d===e;if(s(l)){if(d[c]=l=r&&y&&!i.assigned[c]?o.finalize(l,t.concat(c),r,n):o.finalize(l),y&&l===i.base[c])return}else{if(y&&h(l,i.base[c]))return;f(l)&&!Object.isFrozen(l)&&p(l,u)}y&&a&&a(i,c,l)})),e}}]),e}(),R=(new V).produce;R((function(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.path;if(0===i.length&&"replace"===n.op)e=n.value;else{for(var a=e,u=0;u<i.length-1;u++)if(!(a=a[i[u]])||"object"!==(void 0===a?"undefined":o(a)))throw new Error("Cannot apply patch, path doesn't resolve: "+i.join("/"));var s=i[i.length-1];switch(n.op){case"replace":case"add":a[s]=n.value;break;case"remove":if(Array.isArray(a)){if(s!==a.length-1)throw new Error("Only the last index of an array can be removed, index: "+s+", length: "+a.length);a.length-=1}else delete a[s];break;default:throw new Error("Unsupported patch operation: "+n.op)}}}return e}));var U=function(){function e(){n._classCallCheck(this,e),n._defineProperty(this,"state",{}),n._defineProperty(this,"mount",null)}return n._createClass(e,[{key:"__updateObject",value:function(e,t){for(var r=0,o=Object.entries(t);r<o.length;r++){var i=n._slicedToArray(o[r],2),a=i[0],u=i[1];e.hasOwnProperty(a)&&n._typeof(u)===n._typeof(e[a])&&(["string","number","boolean"].includes(n._typeof(u))||Array.isArray(u)||"[object Date]"===Object.prototype.toString.call(u)?e[a]=u:"object"===n._typeof(u)&&this.__updateObject(e[a],u))}}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e,t){this.state=e,t||this.mount&&this.mount.setState&&this.mount.setState(e)}},{key:"getActionState",value:function(e,t){this.mount&&this.mount.getActionState?this.mount.getActionState(e,t):t()}},{key:"alterState",value:function(e,t){var r=this;if(void 0===e)return this.state;if("object"===n._typeof(e)){var o=R(this.state,(function(t){r.__updateObject(t,e)}));return this.setState(o,t),o}var i=R(this.state,e);return this.setState(i,t),i}},{key:"doMount",value:function(e){this.mount=e}},{key:"unMount",value:function(e){this.mount=null}},{key:"updateView",value:function(e,t,r,n){return this.mount&&this.mount.updateView&&this.mount.updateView(e,t,r,n),!0}}]),e}(),K={StateInstance:U};module.exports=K;
