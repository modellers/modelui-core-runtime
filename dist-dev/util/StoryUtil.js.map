{"version":3,"file":"StoryUtil.js","sources":["../../src/util/StoryUtil.js"],"sourcesContent":["import React from 'react'\n\nconst print_config = {\n  name: 'StoryUtil',\n  type: 'storyutil',\n  author: 'Kjartan JÃ³nsson',\n  description: 'StoryUtil component',\n  version: 0.1,\n  relation: {\n    contains: []\n  },\n  contains: {},\n  options: {}\n}\n\nexport const registerStoryWatchList = (\n  eventHandlerInstance,\n  test_handler,\n  action\n) => {\n  if (!action) {\n    throw Error('registerStorWatchList is missing action handler')\n  }\n  eventHandlerInstance.register(\n    test_handler,\n    {\n      print: {\n        schema: {},\n        handler: (obj) => {\n          console.info(obj)\n          action(obj.event)(obj)\n        }\n      }\n    },\n    {},\n    print_config\n  )\n}\n\nexport const createWatchList = function (\n  eventHandlerInstance,\n  test_handler,\n  component_id,\n  event_types,\n  action\n) {\n  // create watchlist\n  const watch_list = []\n  const test_handler_id = component_id + '_handler_id'\n  if (!action) {\n    throw Error('createWatchList is missing action handler')\n  }\n  event_types.forEach((event_type) => {\n    watch_list.push({\n      component: { id: component_id, event: event_type },\n      trigger: { id: test_handler_id, action: 'print' },\n      transform: function (data) {\n        return { event: event_type, data: data }\n      }\n    })\n  })\n  eventHandlerInstance.watch(watch_list)\n  registerStoryWatchList(eventHandlerInstance, test_handler_id, action)\n}\n\nexport const createEventTriggers = (\n  eventHandlerInstance,\n  component_id,\n  triggers_fn,\n  trigger_data\n) => {\n  const triggers = triggers_fn\n  trigger_data = trigger_data || {} // default none data\n  return (\n    <div>\n      {Object.keys(triggers).map((trigger_id, i) => {\n        let values = { title: trigger_id + '_value', id: trigger_id + '_value' }\n        if (trigger_data[trigger_id]) {\n          values = trigger_data[trigger_id]\n        }\n        return (\n          <button\n            key={trigger_id + '_key_' + triggers[trigger_id].name}\n            title={triggers[trigger_id].info.description}\n            onClick={() => {\n              if (typeof values === 'function') {\n                eventHandlerInstance.addAction(\n                  component_id,\n                  trigger_id,\n                  values()\n                )\n              } else {\n                eventHandlerInstance.addAction(component_id, trigger_id, values)\n              }\n            }}\n          >\n            {triggers[trigger_id].info.name}\n          </button>\n        )\n      })}\n    </div>\n  )\n}\n\nexport const prepStoryComponent = (\n  componentManagerInstance,\n  action,\n  registerComponents,\n  props,\n  triggers,\n  events,\n  overrides\n) => {\n  overrides = overrides || {}\n  const component_manager = componentManagerInstance\n  const state_manager = componentManagerInstance.getStateManager()\n  // attach managers and factories\n  props.manager = component_manager\n  if (typeof action !== 'function') {\n    throw Error('prepStoryComponent is missing action handler')\n  }\n  if (typeof registerComponents !== 'function') {\n    throw Error('prepStoryComponent is missing registerComponents')\n  }\n  registerComponents(component_manager)\n  state_manager.clearAll()\n  state_manager.createLayoutState([props])\n  createWatchList(\n    componentManagerInstance.getEventManager(),\n    props.id + '_handler',\n    props.id,\n    Object.keys(events),\n    action\n  )\n  return createEventTriggers(\n    componentManagerInstance.getEventManager(),\n    props.id,\n    triggers,\n    overrides.triggers\n  )\n}\n\nexport const createStoryArgumentTypesFromSchema = (options_schema) => {\n  // https://storybook.js.org/docs/6.3/react/essentials/controls#annotation\n  // https://json-schema.org/learn/miscellaneous-examples.html\n  const args = {}\n  Object.keys(options_schema.properties).forEach((attr, idx) => {\n    const prop = options_schema.properties[attr]\n\n    args[attr] = {\n      name: prop.title || attr,\n      defaultValue: prop.default,\n      table: {\n        type: {\n          summary: prop.description\n          // detail: prop.description\n        }\n      }\n    }\n\n    if (prop.type === 'boolean') {\n      args[attr].control = { type: 'boolean' }\n    }\n    if (\n      prop.type === 'number' ||\n      prop.type === 'integer' ||\n      prop.type === 'float'\n    ) {\n      args[attr].control = { type: 'number' }\n      if (prop.minimum !== undefined) {\n        args[attr].control = {\n          type: 'range',\n          min: prop.minimum,\n          max: prop.maximum\n        }\n      }\n    }\n    if (prop.type === 'string') {\n      args[attr].control = { type: 'string' }\n    }\n    if (prop.enum) {\n      args[attr].control = { type: 'select', options: prop.enum }\n      if (prop.enum.length < 3) {\n        args[attr].control.type = 'inline-radio'\n      }\n      // args[attr] = PropTypes.oneOf(prop.enum);\n    }\n    if (prop.format === 'color') {\n      args[attr].control = { type: 'color' }\n    }\n    if (prop.type === 'object') {\n      args[attr].control = { type: 'object' }\n    }\n    if (prop.type === 'array') {\n      args[attr].control = { type: 'array' }\n    }\n  })\n  return args\n}\n\nexport const createStoryArgumentDefaultsFromSchema = (options_schema) => {\n  // https://storybook.js.org/docs/6.3/react/essentials/controls#annotation\n  const args = {}\n  Object.keys(options_schema.properties).forEach((attr, idx) => {\n    const prop = options_schema.properties[attr]\n    if (prop.default) {\n      args[attr] = prop.default\n    }\n  })\n  return args\n}\n\nexport const createLayoutViewArgumentTypes = (config) => {\n  // depreciated: user createStoryArgumentTypesFromSchema\n  // https://storybook.js.org/docs/react/essentials/controls#annotation\n  const args = {}\n  const defaultStyles = {\n    // common options\n    label: { control: 'text' },\n    labelPlacement: {\n      control: {\n        type: 'select',\n        options: ['bottom', 'end', 'start', 'top']\n      }\n    },\n    color: {\n      control: {\n        type: 'select',\n        options: [\n          'initial',\n          'inherit',\n          'primary',\n          'secondary',\n          'textPrimary',\n          'textSecondary',\n          'error'\n        ]\n      }\n    },\n    indicatorColor: {\n      control: {\n        type: 'select',\n        options: [\n          'initial',\n          'inherit',\n          'primary',\n          'secondary',\n          'textPrimary',\n          'textSecondary',\n          'error'\n        ]\n      }\n    },\n    textColor: {\n      control: {\n        type: 'select',\n        options: [\n          'initial',\n          'inherit',\n          'primary',\n          'secondary',\n          'textPrimary',\n          'textSecondary',\n          'error'\n        ]\n      }\n    },\n    buttonVariant: {\n      control: {\n        type: 'select',\n        options: ['contained', 'outlined', 'text', 'fab']\n      }\n    },\n    tabVariant: {\n      control: {\n        type: 'select',\n        options: ['inherit', 'fullWidth', 'scrollable']\n      }\n    },\n    contentMargin: {\n      control: {\n        type: 'number'\n      }\n    },\n    variant: {\n      control: {\n        type: 'select',\n        options: ['filled', 'outlined', 'standard']\n      }\n    },\n    size: {\n      control: {\n        type: 'select',\n        options: ['small', 'large', 'medium']\n      }\n    },\n    shape: {\n      control: {\n        type: 'select',\n        options: ['circular', 'rounded', 'square']\n      }\n    },\n    max_count: {\n      control: {\n        type: 'number'\n      }\n    },\n    spacing: {\n      control: {\n        type: 'number'\n      }\n    },\n    direction: {\n      control: {\n        type: 'select',\n        options: ['row', 'row-reverse', 'column', 'column-reverse']\n      }\n    },\n    justify: {\n      control: {\n        type: 'select',\n        options: [\n          'flex-start',\n          'center',\n          'flex-end',\n          'space-between',\n          'space-around',\n          'space-evenly'\n        ]\n      }\n    },\n    alignItems: {\n      control: {\n        type: 'select',\n        options: ['flex-start', 'center', 'flex-end', 'stretch', 'baseline']\n      }\n    },\n    gridXS: {\n      control: {\n        type: 'select',\n        options: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]\n      }\n    },\n    gridSM: {\n      control: {\n        type: 'select',\n        options: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]\n      }\n    },\n    modalType: {\n      control: {\n        type: 'select',\n        options: ['alert', 'dialog', 'modal']\n      }\n    }\n  }\n  // expanded\n  const inputStyles = { ...defaultStyles, ...config.options }\n  // find out what this components supports and return it as argument\n  Object.keys(config.options).forEach((attr, idx) => {\n    const arg = inputStyles[attr]\n    // TODO: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#deprecated-controloptions\n    args[attr] = arg\n  })\n  return args\n}\n\nexport default {\n  createLayoutViewArgumentTypes,\n  createStoryArgumentDefaultsFromSchema,\n  createStoryArgumentTypesFromSchema,\n  prepStoryComponent,\n  createEventTriggers,\n  createWatchList,\n  registerStoryWatchList\n}\n"],"names":["print_config","name","type","author","description","version","relation","contains","options","registerStoryWatchList","eventHandlerInstance","test_handler","action","Error","register","print","schema","handler","obj","console","info","event","createWatchList","component_id","event_types","watch_list","test_handler_id","forEach","event_type","push","component","id","trigger","transform","data","watch","createEventTriggers","triggers_fn","trigger_data","triggers","React","Object","keys","map","trigger_id","i","values","title","createElement","key","onClick","addAction","prepStoryComponent","componentManagerInstance","registerComponents","props","events","overrides","component_manager","state_manager","getStateManager","manager","clearAll","createLayoutState","getEventManager","createStoryArgumentTypesFromSchema","options_schema","args","properties","attr","idx","prop","defaultValue","table","summary","control","undefined","minimum","min","max","maximum","length","format","createStoryArgumentDefaultsFromSchema","createLayoutViewArgumentTypes","config","inputStyles","defaultStyles","label","labelPlacement","color","indicatorColor","textColor","buttonVariant","tabVariant","contentMargin","variant","size","shape","max_count","spacing","direction","justify","alignItems","gridXS","gridSM","modalType","arg","StoryUtil"],"mappings":"gOAEMA,EAAe,CACnBC,KAAM,YACNC,KAAM,YACNC,OAAQ,kBACRC,YAAa,sBACbC,QAAS,GACTC,SAAU,CACRC,SAAU,IAEZA,SAAU,CAAE,EACZC,QAAS,CAAC,GAGCC,EAAyB,SACpCC,EACAC,EACAC,GAEA,IAAKA,EACH,MAAMC,MAAM,mDAEdH,EAAqBI,SACnBH,EACA,CACEI,MAAO,CACLC,OAAQ,CAAE,EACVC,QAAS,SAACC,GACRC,QAAQC,KAAKF,GACbN,EAAOM,EAAIG,MAAXT,CAAkBM,EACpB,IAGJ,CAAA,EACAlB,EAEJ,EAEasB,EAAkB,SAC7BZ,EACAC,EACAY,EACAC,EACAZ,GAGA,IAAMa,EAAa,GACbC,EAAkBH,EAAe,cACvC,IAAKX,EACH,MAAMC,MAAM,6CAEdW,EAAYG,SAAQ,SAACC,GACnBH,EAAWI,KAAK,CACdC,UAAW,CAAEC,GAAIR,EAAcF,MAAOO,GACtCI,QAAS,CAAED,GAAIL,EAAiBd,OAAQ,SACxCqB,UAAW,SAAUC,GACnB,MAAO,CAAEb,MAAOO,EAAYM,KAAMA,EACpC,GAEJ,IACAxB,EAAqByB,MAAMV,GAC3BhB,EAAuBC,EAAsBgB,EAAiBd,EAChE,EAEawB,EAAsB,SACjC1B,EACAa,EACAc,EACAC,GAEA,IAAMC,EAAWF,EAEjB,OADAC,EAAeA,GAAgB,GAE7BE,UACGC,cAAAA,MAAAA,KAAAA,OAAOC,KAAKH,GAAUI,KAAI,SAACC,EAAYC,GACtC,IAAIC,EAAS,CAAEC,MAAOH,EAAa,SAAUb,GAAIa,EAAa,UAI9D,OAHIN,EAAaM,KACfE,EAASR,EAAaM,IAGtBJ,EAAA,QAAAQ,cAAA,SAAA,CACEC,IAAKL,EAAa,QAAUL,EAASK,GAAY3C,KACjD8C,MAAOR,EAASK,GAAYxB,KAAKhB,YACjC8C,QAAS,WACe,mBAAXJ,EACTpC,EAAqByC,UACnB5B,EACAqB,EACAE,KAGFpC,EAAqByC,UAAU5B,EAAcqB,EAAYE,EAE7D,GAECP,EAASK,GAAYxB,KAAKnB,KAGhC,IAGP,EAEamD,EAAqB,SAChCC,EACAzC,EACA0C,EACAC,EACAhB,EACAiB,EACAC,GAEAA,EAAYA,GAAa,GACzB,IAAMC,EAAoBL,EACpBM,EAAgBN,EAAyBO,kBAG/C,GADAL,EAAMM,QAAUH,EACM,mBAAX9C,EACT,MAAMC,MAAM,gDAEd,GAAkC,mBAAvByC,EACT,MAAMzC,MAAM,oDAYd,OAVAyC,EAAmBI,GACnBC,EAAcG,WACdH,EAAcI,kBAAkB,CAACR,IACjCjC,EACE+B,EAAyBW,kBACzBT,EAAMxB,GACNwB,EAAMxB,GACNU,OAAOC,KAAKc,GACZ5C,GAEKwB,EACLiB,EAAyBW,kBACzBT,EAAMxB,GACNQ,EACAkB,EAAUlB,SAEd,EAEa0B,EAAqC,SAACC,GAGjD,IAAMC,EAAO,CAAA,EAoDb,OAnDA1B,OAAOC,KAAKwB,EAAeE,YAAYzC,SAAQ,SAAC0C,EAAMC,GACpD,IAAMC,EAAOL,EAAeE,WAAWC,GAEvCF,EAAKE,GAAQ,CACXpE,KAAMsE,EAAKxB,OAASsB,EACpBG,aAAcD,EAAY,QAC1BE,MAAO,CACLvE,KAAM,CACJwE,QAASH,EAAKnE,eAMF,YAAdmE,EAAKrE,OACPiE,EAAKE,GAAMM,QAAU,CAAEzE,KAAM,YAGf,WAAdqE,EAAKrE,MACS,YAAdqE,EAAKrE,MACS,UAAdqE,EAAKrE,OAELiE,EAAKE,GAAMM,QAAU,CAAEzE,KAAM,eACR0E,IAAjBL,EAAKM,UACPV,EAAKE,GAAMM,QAAU,CACnBzE,KAAM,QACN4E,IAAKP,EAAKM,QACVE,IAAKR,EAAKS,WAIE,WAAdT,EAAKrE,OACPiE,EAAKE,GAAMM,QAAU,CAAEzE,KAAM,WAE3BqE,SACFJ,EAAKE,GAAMM,QAAU,CAAEzE,KAAM,SAAUM,QAAS+D,EAAI,MAChDA,EAAS,KAACU,OAAS,IACrBd,EAAKE,GAAMM,QAAQzE,KAAO,iBAIV,UAAhBqE,EAAKW,SACPf,EAAKE,GAAMM,QAAU,CAAEzE,KAAM,UAEb,WAAdqE,EAAKrE,OACPiE,EAAKE,GAAMM,QAAU,CAAEzE,KAAM,WAEb,UAAdqE,EAAKrE,OACPiE,EAAKE,GAAMM,QAAU,CAAEzE,KAAM,SAEjC,IACOiE,CACT,EAEagB,EAAwC,SAACjB,GAEpD,IAAMC,EAAO,CAAA,EAOb,OANA1B,OAAOC,KAAKwB,EAAeE,YAAYzC,SAAQ,SAAC0C,EAAMC,GACpD,IAAMC,EAAOL,EAAeE,WAAWC,GACnCE,YACFJ,EAAKE,GAAQE,EAAY,QAE7B,IACOJ,CACT,EAEaiB,EAAgC,SAACC,GAG5C,IAAMlB,EAAO,CAAA,EA8IPmB,EAAmBC,EAAAA,eAAAA,iBAAAA,CAAAA,EA7IH,CAEpBC,MAAO,CAAEb,QAAS,QAClBc,eAAgB,CACdd,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,SAAU,MAAO,QAAS,SAGxCkF,MAAO,CACLf,QAAS,CACPzE,KAAM,SACNM,QAAS,CACP,UACA,UACA,UACA,YACA,cACA,gBACA,WAINmF,eAAgB,CACdhB,QAAS,CACPzE,KAAM,SACNM,QAAS,CACP,UACA,UACA,UACA,YACA,cACA,gBACA,WAINoF,UAAW,CACTjB,QAAS,CACPzE,KAAM,SACNM,QAAS,CACP,UACA,UACA,UACA,YACA,cACA,gBACA,WAINqF,cAAe,CACblB,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,YAAa,WAAY,OAAQ,SAG/CsF,WAAY,CACVnB,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,UAAW,YAAa,gBAGtCuF,cAAe,CACbpB,QAAS,CACPzE,KAAM,WAGV8F,QAAS,CACPrB,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,SAAU,WAAY,cAGpCyF,KAAM,CACJtB,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,QAAS,QAAS,YAGhC0F,MAAO,CACLvB,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,WAAY,UAAW,YAGrC2F,UAAW,CACTxB,QAAS,CACPzE,KAAM,WAGVkG,QAAS,CACPzB,QAAS,CACPzE,KAAM,WAGVmG,UAAW,CACT1B,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,MAAO,cAAe,SAAU,oBAG9C8F,QAAS,CACP3B,QAAS,CACPzE,KAAM,SACNM,QAAS,CACP,aACA,SACA,WACA,gBACA,eACA,kBAIN+F,WAAY,CACV5B,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,aAAc,SAAU,WAAY,UAAW,cAG7DgG,OAAQ,CACN7B,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,MAGjDiG,OAAQ,CACN9B,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,MAGjDkG,UAAW,CACT/B,QAAS,CACPzE,KAAM,SACNM,QAAS,CAAC,QAAS,SAAU,aAKQ6E,EAAO7E,SAOlD,OALAiC,OAAOC,KAAK2C,EAAO7E,SAASmB,SAAQ,SAAC0C,EAAMC,GACzC,IAAMqC,EAAMrB,EAAYjB,GAExBF,EAAKE,GAAQsC,CACf,IACOxC,CACT,EAEeyC,EAAA,CACbxB,8BAAAA,EACAD,sCAAAA,EACAlB,mCAAAA,EACAb,mBAAAA,EACAhB,oBAAAA,EACAd,gBAAAA,EACAb,uBAAAA"}