{"version":3,"file":"ListBase.js","sources":["../../src/event/ListBase.js"],"sourcesContent":["// common tools\nimport StateBase from './StateBase'\nimport StateBaseComponent from './StateBaseComponent'\nimport {\n  findItemIndexById,\n  removeItemIndexByIndex,\n  mergeDeep\n} from '../util/ObjUtil'\n// event handler\n// import Event from './Event'\n\nconst schema_only_id = {\n  // \"$schema\": \"http://json-schema.org/draft-06/schema#\",\n  $id: 'v1/listbase/..',\n  type: 'array',\n  items: {\n    $ref: '#/definitions/identifier'\n  },\n  definitions: {\n    identifier: {\n      type: 'object',\n      additionalProperties: true,\n      properties: {\n        id: {\n          type: 'string'\n        }\n      },\n      required: ['id'],\n      title: 'Identifier with additional properties'\n    }\n  }\n}\n\nexport const triggers = {\n  submit: {\n    alias: [],\n    info: {\n      name: 'Submit',\n      description: 'Submit entire list'\n    },\n    schema: {}\n  },\n  replace: {\n    alias: [],\n    info: {\n      name: 'Replace',\n      description: 'Replace data'\n    },\n    schema: {}\n  },\n  push: {\n    alias: [],\n    info: {\n      name: 'Push',\n      description: 'Adds data at the end to component'\n    },\n    schema: {}\n  },\n  push_front: {\n    alias: [],\n    info: {\n      name: 'Push front',\n      description: 'Adds data to the front of the component'\n    },\n    schema: {}\n  },\n  delete: {\n    alias: [],\n    info: {\n      name: 'Delete data instance',\n      description: 'Removes data from the component'\n    },\n    schema: { ...schema_only_id, $id: 'v1/listbase/delete' }\n  },\n  pop: {\n    alias: [],\n    info: {\n      name: 'Pop back item',\n      description: 'Deletes / removes back data item'\n    },\n    schema: {}\n  },\n  pop_front: {\n    alias: [],\n    info: {\n      name: 'Pop front item',\n      description: 'Deletes / removes front data item'\n    },\n    schema: {}\n  },\n  select: {\n    alias: [],\n    info: {\n      name: 'Select item',\n      description: 'Selects the data item'\n    },\n    schema: { ...schema_only_id, $id: 'v1/listbase/select' }\n  },\n  clear: {\n    alias: [],\n    info: {\n      name: 'Clear items',\n      description: 'Removes all items from list'\n    },\n    schema: {}\n  }\n}\n\nexport const events = {\n  changed: {\n    alias: [],\n    info: {\n      name: 'changed',\n      description: 'Changed size'\n    },\n    schema: {}\n  },\n  replacing: {\n    alias: [],\n    info: {\n      name: 'replacing',\n      description: 'Replacing content'\n    },\n    schema: {}\n  },\n  replaced: {\n    alias: [],\n    info: {\n      name: 'replaced',\n      description: 'Replace content'\n    },\n    schema: {}\n  },\n  submitted: {\n    alias: [],\n    info: {\n      name: 'Submitted',\n      description: 'Subbited all items in list'\n    },\n    schema: {}\n  },\n  deleted: {\n    alias: [],\n    info: {\n      name: 'Deleted',\n      description: 'Deleted specified items'\n    },\n    schema: {}\n  },\n  pushing: {\n    alias: [],\n    info: {\n      name: 'Pusing',\n      description: 'Pushing item in front of list'\n    },\n    schema: {}\n  },\n  pushed: {\n    alias: [],\n    info: {\n      name: 'Pushed',\n      description: 'Pushed item in front of list'\n    },\n    schema: {}\n  },\n  selected: {\n    alias: [],\n    info: {\n      name: 'Selected',\n      description: 'Selecting item'\n    },\n    schema: { ...schema_only_id, $id: 'v1/listbase/selected' }\n  },\n  deselected: {\n    alias: [],\n    info: {\n      name: 'De-Selected',\n      description: 'Unselecting item'\n    },\n    schema: {}\n  },\n  clearing: {\n    alias: [],\n    info: {\n      name: 'Clearing',\n      description: 'Removing all items'\n    },\n    schema: {}\n  },\n  cleared: {\n    alias: [],\n    info: {\n      name: 'Cleared',\n      description: 'Removed all items'\n    },\n    schema: {}\n  }\n}\n\nexport class StateList extends StateBase.StateInstance {\n  constructor(props) {\n    super(props)\n    this.props = props\n    // ensure array\n    let _data = []\n    if (props.data) {\n      if (Array.isArray(props.data)) {\n        _data = props.data\n      } else {\n        // check if this is an empty object\n        if (typeof props.data === 'object') {\n          // objects should not be empty\n          if (props.data.length) {\n            _data = [props.data]\n          }\n        } else {\n          _data = [props.data]\n        }\n      }\n    }\n    // apply default values\n    this.state = { data: _data || [], selectedIndex: 0, selectedId: null }\n\n    if (!this.props.manager) {\n      throw new Error('Manager was not passed through StateList props')\n    }\n\n    this.eventManager = this.props.manager.getEventManager()\n  }\n\n  findItemIndexById = (id, data) => {\n    return findItemIndexById(id, data)\n  }\n\n  updateItem = (id, props) => {\n    const idx = this.findItemIndexById(id, this.state.data)\n    const updated = [...this.state.data] // copy\n    // TODO: validate props against schema\n    if (idx >= 0) {\n      for (const [key, value] of Object.entries(props)) {\n        updated[idx][key] = value\n      }\n      this.setState({ ...this.state, data: updated })\n    }\n  }\n\n  registerComponent = (actionHandlers, eventHandlers, component_info) => {\n    actionHandlers = actionHandlers || {}\n    eventHandlers = eventHandlers || {}\n    // add our known handlers\n    const dataActionHandlers = {\n      submit: {\n        schema: {},\n        handler: (objs) => {\n          // submit\n          // Event.EventManager.getInstance().addEvent(\n          this.eventManager.addEvent(\n            this.props.id,\n            'submitted',\n            { count: this.state.data.length, items: this.state.data },\n            {}\n          )\n        }\n      },\n      replace: {\n        schema: {},\n        handler: (objs) => {\n          // append\n          const data_state = this.state.data || []\n          // want an array\n          if (!Array.isArray(objs)) {\n            objs = [objs]\n          }\n          // Event.EventManager.getInstance().addEvent(\n          this.eventManager.addEvent(\n            this.props.id,\n            'replacing',\n            { count: data_state.length, old: data_state, new: objs },\n            {}\n          )\n          const data = objs\n          if (this.updateView('replace', [], [], data)) {\n            this.setState({ ...this.state, data: data })\n          }\n          // Event.EventManager.getInstance().addEvent(\n          this.eventManager.addEvent(\n            this.props.id,\n            'replaced',\n            { count: data.length, items: data },\n            {}\n          )\n          // Event.EventManager.getInstance().addEvent(\n          this.eventManager.addEvent(\n            this.props.id,\n            'changed',\n            { count: data.length, items: data },\n            {}\n          )\n        }\n      },\n      push: {\n        schema: {},\n        handler: (objs) => {\n          // append\n          const data_added = []\n          const data_updated = [] // contains ids\n          const data_state = this.state.data || []\n          let selected = {}\n          // want an array\n          if (!Array.isArray(objs)) {\n            objs = [objs]\n          }\n          objs.forEach((obj) => {\n            const idx = this.findItemIndexById(obj.id, data_state)\n            if (idx === null) {\n              data_added.push(obj)\n            } else {\n              // update the index\n              data_state[idx] = mergeDeep(data_state[idx], obj) // TODO: fetch from utils\n              data_updated.push(idx)\n            }\n            if (obj.selected) {\n              // TODO: test that we can push items that are selected\n              selected = { selectedId: obj.id, selectedIndex: idx }\n            }\n          })\n          const data = [...data_state, ...data_added]\n          // notify parent class of push event\n          try {\n            // Event.EventManager.getInstance().addEvent(\n            this.eventManager.addEvent(this.props.id, 'pushing', data_added, {})\n            if (this.updateView('push', data_added, data_updated, data)) {\n              this.setState({ ...this.state, ...selected, data: data })\n            }\n          } catch (e) {\n            this.exceptionCatched('push', e)\n          }\n          // Event.EventManager.getInstance().addEvent(\n          this.eventManager.addEvent(\n            this.props.id,\n            'pushed',\n            { count: data.length, items: data, added: data_added },\n            {}\n          )\n          // Event.EventManager.getInstance().addEvent(\n          this.ddEvent = this.eventManager.addEvent(\n            this.props.id,\n            'changed',\n            {\n              count: data.length,\n              items: data,\n              added: data_added,\n              updated: data_updated\n            },\n            {}\n          )\n          // FIXME: this.showSelected(selected.selectedId, selected.selectedIndex || -1);\n        }\n      },\n      push_front: {\n        schema: {},\n        handler: (objs) => {\n          const data_added = []\n          const data_updated = []\n          const data_state = this.state.data || []\n          let selected = {}\n          // want an array\n          if (!Array.isArray(objs)) {\n            objs = [objs]\n          }\n          objs.forEach((obj) => {\n            const idx = this.findItemIndexById(obj.id, this.state.data)\n            if (idx === null) {\n              data_added.push(obj)\n            } else {\n              // update the index\n              data_state[idx] = obj\n              data_updated.push(idx)\n            }\n            if (obj.selected) {\n              // TODO: test that we can push items that are selected\n              selected = {\n                selectedId: obj.id,\n                selectedIndex: idx || data_added.length - 1\n              }\n            }\n          })\n          const data = [...data_added, ...data_state]\n          if (this.updateView('push_front', [], data_updated, data)) {\n            this.setState({ ...this.state, ...selected, data: data })\n          }\n          // Event.EventManager.getInstance().addEvent(\n          this.ddEvent = this.eventManager.addEvent(\n            this.props.id,\n            'changed',\n            { count: data.length, items: data },\n            {}\n          )\n          // FIXME: this.showSelected(selected.selectedId, selected.selectedIndex || -1);\n        }\n      },\n      delete: {\n        schema: {},\n        handler: (objs) => {\n          // want an array\n          if (!Array.isArray(objs)) {\n            objs = [objs]\n          }\n          let data = this.state.data\n          const data_updated = []\n          const deleting = []\n          objs.forEach((obj) => {\n            if (obj.id) {\n              // requires array\n              const idx = this.findItemIndexById(obj.id, data)\n              if (idx !== null) {\n                deleting.push(obj.id)\n                data = removeItemIndexByIndex(idx, data)\n                data_updated.push(idx)\n              }\n            }\n          })\n          try {\n            if (this.updateView('delete', [], data_updated, data)) {\n              this.setState({ ...this.state, data: data })\n            }\n          } catch (e) {\n            this.exceptionCatched('delete', e)\n          }\n\n          // Event.EventManager.getInstance().addEvent(\n          this.ddEvent = this.eventManager.addEvent(\n            this.props.id,\n            'changed',\n            { count: data.length, items: data, deleted: deleting },\n            {}\n          )\n          // Event.EventManager.getInstance().addEvent(\n          this.ddEvent = this.eventManager.addEvent(\n            this.props.id,\n            'deleted',\n            { count: deleting.length, items: data, deleted: deleting },\n            {}\n          )\n        }\n      },\n      pop: {\n        schema: {},\n        handler: (obj) => {\n          if (this.state.data.length > 0) {\n            const data = this.state.data.slice()\n            const data_removed = data.splice(data.length - 1, 1) // remove item\n            if (this.updateView('pop', [], data_removed, data)) {\n              this.setState({ ...this.state, data: data })\n              // Event.EventManager.getInstance().addEvent(\n              this.ddEvent = this.eventManager.addEvent(\n                this.props.id,\n                'changed',\n                { count: this.state.data.length, items: this.state.data },\n                {}\n              )\n            }\n          }\n        }\n      },\n      pop_front: {\n        schema: {},\n        handler: (obj) => {\n          if (this.state.data.length > 0) {\n            const data = this.state.data.slice()\n            const data_removed = data.splice(0, 1)\n            if (this.updateView('pop_front', [], data_removed, data)) {\n              this.setState({ ...this.state, data: data })\n              // Event.EventManager.getInstance().addEvent(\n              this.ddEvent = this.eventManager.addEvent(\n                this.props.id,\n                'changed',\n                { count: this.state.data.length, items: this.state.data },\n                {}\n              )\n            }\n          }\n        }\n      },\n      select: {\n        schema: {},\n        handler: (objs) => {\n          const data_updated = []\n          const selected = []\n          // want an array\n          if (!Array.isArray(objs)) {\n            objs = [objs]\n          }\n          // allow only one selection\n          for (let i = 0; i < this.state.data.length; i++) {\n            this.state.data[i].selected = false\n          }\n          // find selected\n          objs.forEach((obj) => {\n            if (obj.id) {\n              // requires array\n              const idx = this.findItemIndexById(obj.id, this.state.data)\n              if (idx !== null) {\n                this.state.data[idx].selected = !this.state.data[idx].selected\n                this.state.selectedId = this.state.data[idx].id\n                this.state.selectedIndex = idx\n                data_updated.push(idx)\n                selected.push(this.state.data[idx])\n              }\n            }\n          })\n          // for now we just replace the state\n          this.setState({ ...this.state, data: this.state.data })\n          // Event.EventManager.getInstance().addEvent(\n          this.ddEvent = this.eventManager.addEvent(\n            this.props.id,\n            'selecting',\n            objs,\n            null\n          )\n          if (this.updateView('select', objs, data_updated, this.state)) {\n            // Event.EventManager.getInstance().addEvent(\n            this.ddEvent = this.eventManager.addEvent(\n              this.props.id,\n              'selected',\n              selected,\n              null\n            )\n          }\n        }\n      },\n      clear: {\n        schema: {},\n        handler: (obj) => {\n          // Event.EventManager.getInstance().addEvent(\n          this.ddEvent = this.eventManager.addEvent(\n            this.props.id,\n            'clearing',\n            { count: this.state.data.length, items: this.state.data },\n            {}\n          )\n          this.setState({ ...this.state, data: [] })\n          // Event.EventManager.getInstance().addEvent(\n          this.ddEvent = this.eventManager.addEvent(\n            this.props.id,\n            'cleared',\n            { count: this.state.data.length, items: this.state.data },\n            {}\n          )\n          // Event.EventManager.getInstance().addEvent(\n          this.ddEvent = this.eventManager.addEvent(\n            this.props.id,\n            'changed',\n            { count: this.state.data.length, items: this.state.data },\n            {}\n          )\n          this.updateView('clear', [], [], [])\n        }\n      }\n    }\n\n    // register componenet overiding or adding new event handlers\n    // this.ddEvent = Event.EventManager.getInstance().register(\n    this.ddEvent = this.eventManager.register(\n      this.props.id,\n      { ...dataActionHandlers, ...actionHandlers },\n      { ...events, ...eventHandlers },\n      component_info\n    )\n    return this.ddEvent\n  }\n}\n\nexport class ListBase extends StateBaseComponent.StateBaseComponent {\n  /**\n   * Used to manage internal state of avatars\n   */\n  constructor(props) {\n    if (!props.config.options) {\n      props.config.options = {}\n    }\n    super(props)\n    this.props = props\n  }\n\n  updateView = (action, arr, updated, data) => {\n    // extend by parent\n    return true\n  }\n\n  exceptionCatched = (action_name, event_object) => {\n    // console.info('ListBase: ' + action_name + ' --> ', event_object)\n  }\n\n  findItemIndexById = (id, data) => {\n    if (this.stateManager) {\n      return this.stateManager.findItemIndexById(id, data)\n    }\n  }\n\n  updateItem = (id, props, silent) => {\n    if (silent) {\n      return this.updateItemSilent(id, props)\n    } else {\n      return this.triggerAction('push', { ...props, id: id })\n    }\n  }\n\n  updateItemSilent = (id, props) => {\n    if (this.stateManager) {\n      return this.stateManager.updateItem(id, props)\n    }\n  }\n\n  getData = () => {\n    return this.state.data\n  }\n\n  showSelectedRow = (row) => {\n    if (this.props.config.options.select) {\n      return row.selected\n    }\n    return false\n  }\n\n  showSelected = (id, idx) => {\n    // parent implementation to update the visual representation\n    return true // returns true to update state. Else do not update state.\n  }\n\n  setSelectedId = (id, evt, selected) => {\n    // Event.EventManager.getInstance().addAction(this.props.id, 'select', { id: id });\n    this.triggerAction('select', { id: id })\n  }\n\n  getSelectedId = () => {\n    const selected = []\n    this.state.data.forEach((itm) => {\n      if (itm.selected) {\n        selected.push(itm.id)\n      }\n    })\n    return selected\n  }\n\n  getItemTreeState = () => {\n    const selected = []\n    const expanded = []\n    this.state.data.forEach((itm) => {\n      if (itm.selected) {\n        selected.push(itm.id)\n      }\n      if (itm.expanded) {\n        expanded.push(itm.id)\n      }\n    })\n    return {\n      selected: selected,\n      expanded: expanded,\n      focused: this.state.selectedId\n    }\n  }\n\n  handleSelect = (key, data, index, evt) => {\n    if (!evt) {\n      this.setSelectedId(data.id, evt)\n    }\n  }\n\n  render() {\n    return null\n  }\n}\n/*\nmodule.exports.triggers = triggers\nmodule.exports.events = events\nmodule.exports.StateList = StateList\nmodule.exports.ListBase = ListBase\n*/\nexport default { events, triggers, StateList, ListBase }\n"],"names":["schema_only_id","$id","type","items","$ref","definitions","identifier","additionalProperties","properties","id","required","title","triggers","submit","alias","info","name","description","schema","replace","push","push_front","delete","_objectSpread","_objectSpread2","pop","pop_front","select","clear","events","changed","replacing","replaced","submitted","deleted","pushing","pushed","selected","deselected","clearing","cleared","StateList","_StateBase$StateInsta","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","_defineProperty","_assertThisInitialized","data","findItemIndexById","idx","state","updated","_toConsumableArray","_i","_Object$entries","Object","entries","length","_Object$entries$_i","_slicedToArray","key","value","setState","actionHandlers","eventHandlers","component_info","dataActionHandlers","handler","objs","eventManager","addEvent","count","data_state","Array","isArray","old","new","updateView","data_added","data_updated","forEach","obj","mergeDeep","selectedId","selectedIndex","concat","e","exceptionCatched","added","ddEvent","deleting","removeItemIndexByIndex","slice","data_removed","splice","i","register","_data","_typeof","manager","Error","getEventManager","_createClass","StateBase","StateInstance","ListBase","_StateBaseComponent$S","_super2","_this2","config","options","action","arr","action_name","event_object","stateManager","silent","updateItemSilent","triggerAction","updateItem","row","evt","itm","expanded","focused","index","setSelectedId","StateBaseComponent","ListBase$1"],"mappings":"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"}